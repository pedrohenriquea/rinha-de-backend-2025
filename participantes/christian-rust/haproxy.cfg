global
    daemon
    maxconn 4096
    nbthread 4

defaults
    mode http
    timeout connect 5s
    timeout client 30s
    timeout server 30s
    option httplog
    option dontlognull
    option redispatch
    retries 3
    balance roundrobin

# Health check endpoint
frontend health_check
    bind *:8888
    http-request return status 200

# Main API frontend
frontend api_frontend
    bind *:80
    default_backend api_backend
    
    # Otimizações de performance
    option httpclose
    option forwardfor
    
    # Rate limiting básico
    stick-table type ip size 100k expire 30s store http_req_rate(10s)
    http-request track-sc0 src
    http-request reject if { sc_http_req_rate(0) gt 100 }

# Backend servers
backend api_backend
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200
    server app1 app1:9999 check inter 5s fall 3 rise 2
    server app2 app2:9999 check inter 5s fall 3 rise 2
